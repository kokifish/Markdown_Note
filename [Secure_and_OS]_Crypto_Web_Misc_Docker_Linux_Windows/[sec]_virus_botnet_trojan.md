

> https://www.joesandbox.com/

# 传统计算机病毒

传统计算机病毒分为三大类

1. 感染引导区病毒
2. 感染可执行文件病毒: 数量最多，感染com exe，32bit中叫PE(与Unix Coff格式类似)
3. 感染数据文件病毒：比如感染office文件的宏病毒

- exe一般叫做MZ格式，EXE文件打开二进制前2位字母位M和Z。比COm先进于动态重定位功能，感染难度高。
- NE格式

宏病毒：利用系统的开放性专门制作的一个或多个具有病毒特点的宏的集合，这种病毒宏影响到计算机的使用，并能通过文档及模板进行自我复制及传播。

支持宏病毒的应用系统特点：

1. 可以把特定的宏命令代码附加在指定文件上
2. 可以实现宏命令在不同文件之间的共享和传递
3. 可以在未经使用者许可的情况下获取某种控制权

e.g. word, excel, access, visio, autoCAD, coral draw, pdf等可以插入宏命令的

宏病毒特点：传播极快，制作、变种方便，破坏可能性极大，多平台交叉感染，地域性问题





Linux病毒列表：

1. Bliss病毒
2. Typot木马

Linux病毒分类：

1. Shell脚本病毒
2. 蠕虫病毒
3. 欺骗库函数
4. 内核级的传播
5. 与平台兼容的病毒(一般指win Linux)





# Trojan Horse

> 特洛伊木马

- 与远程计算机之间建立起连接，使远程计算机能够通过网络控制用户计算机系统并且可能造成用户的信息损失、系统损坏、瘫痪的程序

- 硬件：控制端、服务端、Internet
- 软件：控制端程序、木马程序、木马配置程序
- 连接：控制、服务端IP，控制、服务端Port
- 特征：隐蔽性，自动运行，欺骗性，自动恢复功能，自动打开特别的端口，功能的特殊性，黑恶组织趋于公开化

分类：

1. 远程控制：
2. 发送密码：
3. 键盘记录：
4. 破坏型：
5. FTP型：

木马的关键技术：

1. 木马植入：将木马程序放入目标系统中
   1. 升级植入：如修改安卓补丁
   2. 网站(网页)植入：**网站挂马**。把木马连接潜入到网站上，用户访问网站时，木马自动种植到用户计算机上
   3. 漏洞植入：通过系统漏洞，间接桥梁如局域网，Wifi，蓝牙，红外等
   4. U盘植入：
   5. 程序绑定：木马与常用共享软件绑定
2. 自动加载：
   1. 修改批处理程序：autoexec.bat, winstart.bat, dosstart.bat
   2. 修改系统配置：win.ini, system.ini
   3. 修改注册表：修改注册表中的Run来启动：Run, RunOnce, RunOnceEx, RunServices, RunServicesOnce, 通过文件关联启动（如冰河木马病毒）
   4. 借助自动运行功能：根目录下新建Autorun.inf
   5. API hook启动：利用经常使用的API启动木马
   6. VXD启动：驱动程序启动
   7. 浏览网页启动：利用MIME漏洞
   8. 网络编程语言启动：Java applet
   9. 系统的自动运行程序：e.g. ScanDisk
   10. 由其他进程引导：远程线程插入，当宿主程序的进程启动时，木马以线程方式插入其中自动运行
3. 通信技术
4. 隐藏技术
   1. 连接隐藏
   2. 端口隐藏：两种思路：
      1. 寄生：找已经打开的端口，平时只监听，遇到特殊执行就进行解释执行
      2. 潜伏：使用IP协议族中其他协议而非TCP/UDP，瞒过Netstat和端口扫描工具。e.g. 利用ICMP，对网卡/Modem底层编程
   3. 进程隐藏
      1. 让系统管理员看不见：欺骗用户和IDS用来查看进程的函数，如截获相应API调用，替换返回的数据。(PSAPI Process Status API, PDH Performance Data Helper, ToolHelp API)
      2. 不使用进程：DLL，不独立运行，由进程加载并调用。用其他程序调用DLL：
         1. RUNDLL32：一个微软提供的exe程序 RUNDLL32.exe mydll.dll  myfunc
         2. 特洛伊DLL，使用欺骗DLL替换常用DLL，通过函数转发器将正常的调用转发给原DLL，截获并处理特定的消息。弱点：system32下有个dllcache目录，存放大量DLL，一旦操作系统发现被保护的DLL被篡改（数字签名技术），就会自动从dllcache中恢复。绕过：先改dllcache中的备份再改DLL，利用KnownDLLs键值更改DLL默认启动路径等
         3. 线程插入技术，动态嵌入技术（较高端）：将自己的代码嵌入正在运行的进程中。通过CreateRemoteThread可以再另一个进程内创建新线程，可共享远程进程的地址空间

反弹式木马：利用防火墙对内部发起的连接请求无条件信任的特点，假冒是系统的合法网络请求来取得对外的端口，再通过某些方式连接到木马客户端，从而窃取用户计算机资料、遥控计算机本身。e.g. 网络神偷

ICMP隐藏连接：ICMP报文由系统内核或进程直接处理而不是通过端口，给木马摆脱端口的机会。木马将自己伪装成一个Ping的进程，系统就会将`ICMP_ECHOREPLY`(Ping回包)的监听处理权交给木马进程。一旦实现约定好的`ICMP_ECHOREPLY`包出现（可以判断包大小、`ICMP_SEQ`等特征），木马就立即接受，分析并从报文中解码出命令和数据。即使防火墙过滤ICMP报文，一般也不过滤`ICMP_ECHOREPLY`包，否则就不能进行Ping操作，因此具有对防火墙、网关的穿透能力。



# 手机恶意代码





# 蠕虫

>  worm

- 恶意代码的一种，传播不需要激活，通过分布式媒介进行图传播
- 传播性；隐蔽性；破坏性。独有性质：不利用文件寄生，对网络造成拒绝服务，和黑客技术相结合

1. 利用系统漏洞，主动攻击，可对互联网造成瘫痪性后果：红色代码、尼姆达、SQL蠕虫王
2. 针对个人用户：通过网络(email, 恶意网页)迅速传播的蠕虫病毒。爱虫病毒、求职信病毒

蠕虫和传统病毒的区别

|          | 传统病毒     | 蠕虫       |
| -------- | ------------ | ---------- |
| 存在形式 | 寄存文件     | 独立程序   |
| 传染机制 | 宿主程序运行 | 主动攻击   |
| 传染对象 | 本地文件     | 网络计算机 |



1. 主程序：收集与当前机器联网的其他机器的信息，利用漏洞在远程机上建立引导程序
2. 引导程序把蠕虫病毒带入它所感染的每一台机器中

如震网病毒(stuxnet)，感染并破坏了伊朗的核设施

Wannacry：勒索型病毒，有蠕虫的特点。探测扫描Windows主机端口SMB445是否开放，进而利用漏洞校验方式验证是否存在漏洞，为下一步Windows SMB远程代码执行漏洞MS17-010的执行进行信息收集。利用永恒之蓝 高威胁可利用漏洞。使用WNCRY家族和ONION家族的勒索病毒模块。



# 僵尸网络





# APT

> Advanced Persistent Threat 高级持续性威胁

- 利用先进的攻击手段对特定目标进行长期持续性网络攻击的攻击形式
- APT攻击并没有任何崭新的攻击手段。APT中运用的攻击手段，0Day漏洞、钓鱼邮件、社会工程、木马、DDOS等都是存在已久的攻击手段。只是多种攻击手段的综合利用



# 恶意代码检测

1. 系统启动前防御
2. 内核级主动防御
3. 云查杀
4. 人工智能引擎







- 冷备份
- 温备份
- 热备份：备份处于联机状态，保持备份系统与当前应用系统数据同步。恢复时间短，数据完整性、一致性最好，通信要求高





# 防范方案 策略

全球恶意代码库维护机构

- WildList
- AMTSO: Anti-Malware Testing Standards Organization 反恶意软件测试标准组织

反病毒软件测评机构：

- ICSA实验室
- Virus Bulletin
- AV-Comparatives
- AV-Test
- 计算机病毒防治产品检验实验室



信息三要素：

1. 保密性
2. 完整性
3. 可用性

信息安全等级保护：一至五级重要性逐级提高，安全要求逐级增加，安全保护能力逐级增强

| 受侵害的客体                   | 一般损害 | 严重损害 | 特别严重损害 |
| ------------------------------ | -------- | -------- | ------------ |
| 公民、法人和其他组织的合法权益 | 1        | 2        | 2            |
| 社会秩序、公共利益             | 2        | 3        | 4            |
| 国家安全                       | 3        | 4        | 5            |



1. 对预算的管理：没有绝对安全，安全是balance，compromise
2. 组件人员团队：计划小组，操作小组、组织实施人员
3. 指定防御计划：制定资产(技术)目录，明确防御范围，讨论和编写防御计划
4. 测试和实施：分步测试，试点实施
5. 运行和维护：定期测试、检查，用户培训，变更维护，安全事件处置演练，快速反应小组的测试

额外的防御工具：

防火墙，入侵检测系统，蜜罐，端口监视和扫描程序，漏洞扫描程序，Internet内容扫描程序，备份





# 熊猫烧香

- 可在Windows XP上使用process monitor监控病毒行为
- 创建spoclsv.exe。在注册表创建自启，把杀毒软件在注册表中的自启动项删除。创建svcshare自启动，使得可以自启动。修改注册表使得隐藏文件不能通过普通操作显示出来（资源管理器的显示隐藏文件）`HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Midden\SHOWALL`将`CheckedValue`的键值设置为0。将自身拷贝到根目录，命名为setup.exe，同时创建autorun.inf用于病毒启动，属性都是隐藏。向外发包，连接局域网中其他机器。

